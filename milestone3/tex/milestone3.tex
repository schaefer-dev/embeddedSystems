% exercise sheet with header on every page for math or close subjects
\documentclass[12pt]{article}
\usepackage[utf8]{inputenc}
\usepackage{latexsym}
\usepackage{multicol}
\usepackage{fancyhdr}
\usepackage{amsfonts}
\usepackage{amsmath}
\usepackage{amssymb}
\usepackage{enumerate}
\usepackage{listings}
\usepackage{graphicx}

% Shortcuts for bb, frak and cal letters
\newcommand{\E}{\mathbb{E}}
\newcommand{\V}{\mathbb{V}}
\renewcommand{\P}{\mathbb{P}}
\newcommand{\N}{\mathbb{N}}
\newcommand{\R}{\mathbb{R}}
\newcommand{\C}{\mathbb{C}}
\newcommand{\Z}{\mathbb{Z}}
\newcommand{\Pfrak}{\mathfrak{P}}
\newcommand{\Pfrac}{\mathfrak{P}}
\newcommand{\Bfrac}{\mathfrak{P}}
\newcommand{\Bfrak}{\mathfrak{B}}
\newcommand{\Fcal}{\mathcal{F}}
\newcommand{\Ycal}{\mathcal{Y}}
\newcommand{\Bcal}{\mathcal{B}}
\newcommand{\Acal}{\mathcal{A}}

% formating
\topmargin -3.5cm
\textheight 22cm
\textwidth 16.0 cm
\oddsidemargin -0.1cm

% Fancy Header on every Page
\pagestyle{fancy}
\lhead{\textbf{Embedded Systems Milestone 3}\\Hardware Number 1}
\rhead{Daniel Sch√§fer (2549458)\\ Rafael Dewes (2548365)\\ Kevin M\"uller (2550062)}
\renewcommand{\headrulewidth}{1.2pt}
\setlength{\headheight}{110pt}

\begin{document}
\pagenumbering{gobble}
\lstset{language=C++}

%\section*{Draft: Notes which Tasks exist for both robots}

%\subsection*{NOTES: List of Tasks Scout}
%\begin{itemize}
%  \item Receive photosensor readings (periodic), might queue the task to handle high readings
%  \item Handle high photosensor readings (high priority), puts collector communication into task queue
%  \item communicate harvesting position to collector (high priority)
%  \item Correct Theta (by changing the current velocities of the two motors) to point towards current destination (preemptive, lowest priority, if condition for turning not true - just continue to drive straight). This tasks queries the "generate new destination" task upon reaching the current destination
%  \item Generate new Goal (medium priority), generate new destination where to drive - mainly tactic finetuning (initially will generate random value)
%  \item Send collector the currently estimated scout position (low priority, periodic)
%  \item Receive Referee updates and update estimation (medium priority, triggered by interrupt)
%\end{itemize}

\subsection*{Scout Tasks}

\paragraph{Receive Photosensor Readings}
We receive the readings of the photosensors via the ADC, and check them against a threshold.
If treshold is met, we save current brightness value in memory; queue handling task.
\begin{itemize}
	\item \textbf{periodic}, as we need to check if the robot is in the light in regular intervals
	\item \textbf{non-preemptive}, dependent on current state of the robot, important for main functionality, initiates follow up task
	\item \textbf{not known beforehand}, we can't foresee the light behaviour
	\item \textbf{period and release time} can be the same, we assume about [10ms] but need experience with the actual hardware to fine-tune
	\item \textbf{approximate cost}: we get 4 values for each of the sensors and need to compare each to the threshold, possibly write one value and our position into memory 
	\item \textbf{urgency}, very urgent
	\item \textbf{dependencies}: not dependent on other tasks
\end{itemize}

\paragraph{Handle High Readings}
This task is generated if the value the photosensors output meets the determined threshold. It takes the current position of the robot and writes it into memory, then queues the communication.
\begin{itemize}
	\item \textbf{not periodic}, only triggered by preceding task
	\item \textbf{non-preemptive}, the current position is time critical and should not be postponed to get the most accurate and direct data, essential for the functionality of the Scout
	\item \textbf{not known beforehand}, as it is queued by other task
	\item \textbf{release time}: since the earliest we can get a new position that we want to send is after [10ms], our release time can be that also
	\item \textbf{approximate cost}: get current coordinates and write them into a secure memory
	\item \textbf{urgency}, very urgent
	\item \textbf{dependencies}: dependent on the "Receive Photosensor Readings" task for adding it to the schedule; also dependent on the basic driving task "Orientation Theta Correction"
\end{itemize}

\paragraph{Communicate Harvest Coordinates}
This task is generated after the photosensor values meet the threshold and the current position is saved. It takes the saved position in the memory and communicates it to the Collector via the RF module.
\begin{itemize}
	\item \textbf{not periodic}, only triggered by preceding task
	\item \textbf{non-preemptive}, the communication of this position is important and should not be postponed, essential for the functionality of the Scout
	\item \textbf{not known beforehand}, as it is queued by other task
	\item \textbf{release time}: since the earliest we can get a new position that we want to send is after [10ms], our release time can be that also
	\item \textbf{approximate cost}: read coordinates from memory and instruct RF module with communication 
	\item \textbf{urgency}, very urgent
	\item \textbf{dependencies}: dependent on the "Receive Photosensor Readings" and "Handle High Readings" tasks for adding it to the schedule and saving the position coordinates
\end{itemize}

\paragraph{Orientation Theta Correction}
The main task concerning movement of the robot. We adjust the orientation of our robot by changing the current velocities of the two motors, to point towards current destination. If no adjustment is required we drive straight. This tasks queries the "generate new destination" task upon reaching the current destination or if there is none.
\begin{itemize}
	\item \textbf{not periodic}, only one instance of this task is ever created
	\item \textbf{preemptive}, very basic task with lengthy execution. Must be preemptive for the robot to do anything but drive around. 
	\item \textbf{not known beforehand}, destinations are generated by other task
	\item \textbf{release time}:task is immediately available 
	\item \textbf{approximate cost}: this task is greatly dependent on the physical properties of the robot, and as such is very slow and very costly time wise. 
	\item \textbf{urgency}, lowest urgency. The only risk of this task being delayed would be leaving the arena after missing the destination, but that would mean an extreme delay which seems unlikely considering the other tasks.
	\item \textbf{dependencies}: dependent on the "Generate New Goal" task to define the destination position.
\end{itemize}

\paragraph{Generate New Goal}
Generates a new destination on where to drive - mainly tactic finetuning (initially will generate random value)
\begin{itemize}
	\item \textbf{aperiodic}, only generated by other task
	\item \textbf{preemptive}, not critical for time constraints, can be postponed for more urgent tasks
	\item \textbf{not known beforehand}, we don't know when the robot reaches its destination
	\item \textbf{release time} immediately available after it is added to the schedule by other task
	\item \textbf{approximate cost}: Either generate random coordinates (OR look up next destination for strategy), very low cost
	\item \textbf{urgency}, medium urgency as we don't want the robot to idle too long, but need other functionalities quicker under stricter time constraints. Exact urgency is dependent on the strategy as we could have a very narrow path to follow where accuracy is essential.
	\item \textbf{dependencies}:dependent on "Orientation Theta Correction" to be queued up
\end{itemize}

\paragraph{Communicate Own Position}
The Scout communicates its own position to the Collector in regular intervals as to not get pushed by its teammate. 
\begin{itemize}
	\item \textbf{periodic}, because we need to let our teammate know where we are regularly
	\item \textbf{non-preemptive}, dependent on current state of the robot, important for communication
	\item \textbf{not known beforehand}, we can't know positions
	\item \textbf{period and release time} can be the same, as we want to communicate in a regular interval. We assume about [0.5s] is enough but need experience with the actual hardware to fine-tune
	\item \textbf{approximate cost}: we get the current position coordinates and initiate communication of these via the RF module, low cost
	\item \textbf{urgency}: this task is relatively urgent to prevent our Collector from pushing the Scout.
	\item \textbf{dependencies}: It is dependent on the current position, so "Orientation Theta Correction".
\end{itemize}

\paragraph{Receive Referee Communication}
The robot can receive its correct position in the arena from the referee. If a message was received the RF module sends an interrupt to trigger this task. The Scout handles this information by updating the internal records and continuing with the updated coordinates.
\begin{itemize}
	\item \textbf{not periodic}, triggered by interrupt from the RF module
	\item \textbf{non-preemptive}, to be completed as soon as possible, s.t. the internal coordinates are accurate. Also very short task, so little delay for other tasks.
	\item \textbf{not known beforehand}, triggered by external source
	\item \textbf{release time}: Immediately available after interrupt
	\item \textbf{approximate cost}: Receiving the correct coordinate data and updating them internally has a very low cost.
	\item \textbf{urgency}:extremely urgent, we want to minimise the time we are using inaccurate coordinates for our postion calculation.
	\item \textbf{dependencies}: no dependencies
\end{itemize}

\subsection*{Collector Tasks}
\begin{enumerate}
  \item Receive proximity sensor readings and queue task to handle readings above the threshold.
  	\begin{itemize}
  	\item \textbf{Main properties:} Periodic, non-preemtive and not entirely known before-hand
  	\item \textbf{Release time:} Same as the period (immediately available)
  	\item \textbf{Period:} Since this task can be handled very fast, the period can also be very fast. We will start with a period of 10ms and later fine-tune it using the hardware.
  	\item \textbf{Relative deadline:} Does not need a deadline
  	\item \textbf{Approximate cost:} The following operations need to be executed where the last one needs to be done only when the readings are higher than the threshold, which should happen rather rarely: Read each the sensor (3) and for each one compare the value to the threshold (3), enqueue task (i.e. make call to the scheduler) to handle high readings (2). We argue that the first eight tasks (read and compare) can be executed almost immediately and the last one also very fast. Therefore we assign this task a (relative) cost of 3+3+2=8.
  	\item \textbf{Urgency:} The worst thing that happens when the task is delayed for too long it that he robot might not see another robot nearby. This does not do any damage. However, it might also collide with its team mate which would do significant damage so this task has a (relative) urgency of 5.
  	\item \textbf{Dependencies:} No dependencies on other tasks.
  	\end{itemize}
  \item Handle high proximity readings, includes calculation if its own scout.
  	\begin{itemize}
  	\item \textbf{Main properties:} Aperiodic, non-preemtive, not entirely known before-hand
  	\item \textbf{Release time:} Becomes available as soon as enqueued by other task. (= 0 or not applicable?)
  	\item \textbf{Relative deadline:} Depending on the threshold, this task should get a deadline that ensures that the collector will never push its team mate. Since we have not fixed the threshold proximity and maximum driving speed, the exact deadline can only be calculated later when working with the real hardware.
  	\item \textbf{Approximate cost:} The following operations need to be executed: Retrieve last scout position (1), retrieve time and calculate elapsed time since last scout position update (3), calculate the distance that he scout has traveled since (i.e. the radius where scout might be) (2), compare current proximity value with possible scout position (3) and make decision whether to hit or not and depending on the result set the current destination value (1). Therefore we assign this task a (relative) cost of 1+3+2+3+1=10. 
  	\item \textbf{Urgency:} This task has about he same reasoning for urgency as Task 1, so it also gets an urgency of 5.
  	\item \textbf{Dependencies:} This task can only be executed after Task 1. This is ensured because this task is scheduled at the end of Task 1 when all rw operations to the shared global memory are done and the task is finished.
   	\end{itemize} 	
  \item Correct Theta (by changing the current velocities of the two motors) to point towards current destination (preemptive, lowest priority, if condition for turning not true - just continue to drive straight). This tasks queries the "generate new destination" task upon reaching the current destination
  \begin{itemize}
  	\item \textbf{Main properties:} Periodic, preemtive, not entirely known before-hand
  	\item \textbf{Release time:} Same as the period (immediately available)
  	\item \textbf{Relative deadline:} Does not need a deadline
  	\item \textbf{Approximate cost:} The cost is proportional to the radius that the robot needs to turn and depends on the wheel velocities we choose. In any case, this task takes a lot longer than all other tasks because a physical motion and calculation of the new rotation needs to be done. We could set the cost of this task to be 20 per degree the robot needs to turn.
  	\item \textbf{Urgency:} If the task gets delayed for too long we might miss the target destination and in the worst case cross the arena border. However, for this to happen the task would have to be delayed for a very long time which is why it will get a relatively low urgency of 1.
  	\item \textbf{Dependencies:} The robot needs a destination before executing this task. Therefore, Task 5 has to finish before this task starts for the first time. This task queues Task 4 upon reaching the current destination.
   	\end{itemize} 	
  \item Generate new Goal (medium priority), generate new destination where to drive - mainly tactic finetuning (initially will generate random value)
  \begin{itemize}
  	\item \textbf{Main properties:} Aperiodic, preemtive, not entirely known before-hand.
  	\item \textbf{Release time:} Becomes available as soon as enqueued by other task. (= 0 or not applicable?)
  	\item \textbf{Relative deadline:} Does not need a deadline.
  	\item \textbf{Approximate cost:} The cost highly depends on the tactic implemented. Since this can possibly take a long time, the task needs to be preemtive. For not, we will just randomly generate valid destinations. A simple implementation using the clock (1) and some arithmetic operations (5) could generate such destinations with a cost of 2 x (1 + 5) = 12.
  	\item \textbf{Urgency:} It is never a problem when the task gets delayed for some time because the robot will never drive blindly without having a destination. So, when no new destination gets generated for some time the robot will simply remain at its position. The only loss would be that we can not execute our tactic but that is not a big problem compared to hitting team mates or crossing the arena border. Therefore, just as Task 4 this task gets an urgency of 1.
  	\item \textbf{Dependencies:} This task is executed when Task 4 is finished and the current destination is reached.
   	\end{itemize}
  \item Receive Referee updates and update estimation.
    \begin{itemize}
  	\item \textbf{Main properties:} Aperiodic (triggered by interrupt), non-preemtive (low cost), entirely known before-hand.
  	\item \textbf{Release time:} Immediately available after interrupt.
  	\item \textbf{Relative deadline:} Does not need a deadline.
  	\item \textbf{Approximate cost:} The robot needs to read the data from the RF module (1) and extract both x and y positions as well as the angle (3). It then update its internal estimated position to match the real position (3). It therefore gets a cost of 7.
  	\item \textbf{Urgency:} Driving with an incorrent estimation of the real position is very bad. Considering that collisions occur very often, it is extremly important to update the estimation as soon as possible. It therefore gets a relatively high urgency of 10.
  	\item \textbf{Dependencies:} No dependencies.
   	\end{itemize}
  \item Handle received harvesting position (highest priority, triggered by interrupt). Overwrites current destination regardless of roboter state.
  \begin{itemize}
  	\item \textbf{Main properties:} Aperiodic (triggered by interrupt), non-preemtive (low cost), not entirely known before-hand.
  	\item \textbf{Release time:} Immediately available after interrupt.
  	\item \textbf{Relative deadline:} Does not need a deadline.
  	\item \textbf{Approximate cost:} The robot needs to read the data from the RF module (1) and extract both x and y positions of the harvest position (2). It then updates the current destination (2). Therefore, cost = 4.
  	\item \textbf{Urgency:} Since the light moves very fast, it is important to react very fast to new harvest positions. When the collector waits for too long, the light might have moved somewhere else. It therefore gets a relatively high urgency of 10.
  	\item \textbf{Dependencies:} No dependencies.
   	\end{itemize}
\end{enumerate}


\end{document}
